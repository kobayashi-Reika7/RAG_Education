【2026/02/16 00:00:00】
RAG_Educationのgitリモートを設定（https://github.com/kobayashi-Reika7/RAG_Education.git）
- git remote add ragedu でリモート追加
- 本日のログファイル（2026_02_16.md）を新規作成

【2026/02/16 01:00:00】
PDF OCR環境をセットアップ
- PyMuPDF, pytesseract をpipインストール
- Tesseract OCR 5.4.0 をwingetでインストール
- 日本語データ（jpn.traineddata, jpn_vert.traineddata）をダウンロード
- tessdata をRAG/backend/tessdata/ にローカル配置

【2026/02/16 02:00:00】
RAG教育クイズアプリ - プロジェクト構造・設計ドキュメント作成
- RAG_Education/ プロジェクトディレクトリ作成（docs, frontend, backend, data）
- docs/00_requirements_overview.md: PM要件整理（原文保存）
- docs/01_requirements.md: 要件定義書
  - 機能一覧: RAG質問応答 + 理解度テスト（初級/中級/上級）
  - 技術スタック: Next.js / FastAPI / Ollama / ChromaDB
  - MVP 10営業日スケジュール
- docs/02_basic_design.md: 基本設計書
  - システム構成図（フロント→API→RAG→Ollama）
  - 画面設計（トップ/QA/クイズ）3画面
  - データフロー図（質問応答・クイズ）
  - ディレクトリ構成
- docs/03_api_design.md: API設計書
  - POST /api/ask（質問応答）
  - POST /api/quiz/generate（クイズ生成）
  - POST /api/quiz/evaluate（クイズ判定）
  - GET /api/health（ヘルスチェック）
  - リクエスト/レスポンスJSON例・エラーコード定義

【2026/02/16 03:00:00】
GCP Vision API OCR パイプライン整備
- GCS権限確認: Firebaseサービスアカウントに storage.objects.list 権限なし → 要GCPコンソール設定
- scripts/GCP_OCR_SETUP.md: GCP権限設定手順書を作成
  - Cloud Vision API有効化手順
  - IAMロール付与手順（Storage オブジェクト管理者）
  - バケット作成・PDFアップロード手順
- scripts/pdf_ocr_pipeline.py: 汎用OCRパイプラインスクリプトを新規作成
  - バケット内の全PDF自動検出
  - Vision API OCR実行 → テキスト抽出 → NFKC正規化 → チャンク分割 → JSON保存
  - --output-dir で出力先変更可能（RAG_Education対応）
  - --skip-ocr で既存OCR結果の再変換のみ可能
  - argparse対応（CLI引数でPDF指定・バケット指定）

【2026/02/16 03:30:00】
OCRテキスト整形 → チャンク再分割 → Embedding → ベクトルDB → 検索確認
- OCRテキスト整形（超重要工程）
  - 不要改行削除（文中の改行を結合）
  - OCRノイズ除去（「LL M」→「LLM」、孤立「•」削除）
  - 見出し保持（第1章〜第13章の章構造を維持）
  - 章順の修正（OCRでバラバラだった順序を正しく並べ替え）
- チャンク再分割: 4チャンク → 14チャンク（章単位で1チャンク1トピック）
- metadata充実: section（章名）, category, area, tags を全チャンクに設定
- Embedding生成: intfloat/multilingual-e5-base（多言語対応）
- ChromaDB保存: RAG_education/backend/chroma_db/ に14ドキュメント登録
- 検索確認テスト: 10問中9問正解（90%）
  - MISS: 「RAGとは？」→ manual_001(はじめに)に引きずられた（manual_003/004が正解）
  - HIT: Embedding, ベクトルDB, ハルシネーション, OCR, プロンプト等は全てTop1正解
  - 距離スコア: 0.16〜0.33（良好な近さ）

【2026/02/16 04:00:00】
GCP新プロジェクト「RAGeducation」でVision API OCR実行
- プロジェクトID: rageducation
- バケット: ex_pdf
- サービスアカウント: ocr-pipeline@rageducation.iam.gserviceaccount.com
- キー: RAG_education/backend/rageducation-650d026036b7.json
- GCS権限テスト: list / write / delete 全てOK
- OCR実行: RAG_AI_Manual.pdf (1774文字 → 4チャンク)
- 出力: RAG_education/backend/data/rag_ai_manual_chunks.json
  - 全13章の新人向けRAG/AI基礎マニュアル
  - 章末クイズ問題付き（RAG教育アプリのクイズ機能に直接活用可能）

【2026/02/16 05:00:00】
設計書をAWS構成に全面更新
- 01_requirements.md: 技術スタックをAWSに変更
  - LLM: Ollama → Amazon Bedrock (Claude 3.5 Haiku)
  - ベクトルDB: ChromaDB(ローカル) / OpenSearch Serverless(本番)
  - Embedding: HuggingFace(ローカル) / Bedrock Titan Embeddings(本番)
  - デプロイ: Lambda + API Gateway + Amplify
- 02_basic_design.md: AWS構成図を追加
  - ローカル開発構成（従来）+ AWSクラウド構成（新規）
  - サービス対応表（ローカル↔AWS 10項目）
  - Bedrockモデル（Claude 3.5 Haiku / Titan Text / Titan Embeddings）
  - デプロイ手順概要・環境切替の実装方針
- 03_api_design.md: デプロイ情報を追加
  - ベースURL: localhost:7000 に統一
  - Lambda + Mangum アダプタ構成
  - Lambda環境変数定義（APP_ENV, BEDROCK_MODEL_ID等）

【2026/02/16 06:00:00】
アプリケーション実装 + 起動確認
- バックエンド（FastAPI, port 7000）
  - backend/main.py: FastAPI エントリポイント（CORS対応）
  - backend/src/config.py: 設定定数（ChromaDB, Embedding）
  - backend/src/llm_client.py: Gemini 2.5 Flash でLLM呼び出し
  - backend/src/rag_engine.py: ChromaDB検索 → プロンプト構築 → 回答生成
  - backend/src/quiz_engine.py: クイズ生成（初級/中級/上級）+ LLM判定
  - API動作確認: /api/health OK, /api/ask OK（RAG質問応答正常動作）
- フロントエンド（Vite + React + TypeScript + Tailwind CSS, port 3000）
  - AskTab: チャット形式の質問応答UI
  - QuizTab: 難易度選択 → 出題 → 回答 → 判定のフロー
  - Viteプロキシで /api → localhost:7000 に転送
  - 起動確認: http://localhost:3000/ でHTML正常返却

【2026/02/16 07:00:00】
検索精度チューニング（Before 90% → After 93%）
- 問題分析
  - E5モデル(intfloat/multilingual-e5-base)の query:/passage: プレフィックス未適用
  - チャンク内に章末クイズテキストが混入 → Embeddingの意味がブレる
  - スコア閾値なし（低関連度の結果もそのまま使用）
- 改善実施
  1. E5プレフィックス適用（最重要）
     - build_vectordb.py: "passage: {section}。{content} キーワード: {tags}" で登録
     - rag_engine.py: 検索時に "query: {question}" で検索
  2. チャンクデータ整理
     - 全14チャンクから「【章末クイズ】Q1:...」のノイズテキストを除去
     - manual_003 の冒頭に「RAGとは、」を追加（Q1 MISSの直接対策）
     - tagsに「RAGとは」を追加
  3. メタデータ結合Embedding
     - section名とtagsをEmbeddingテキストに結合 → 意味の明確化
  4. スコア閾値フィルタリング
     - SCORE_THRESHOLD = 0.55 で無関係な検索結果を除外
     - TOP_K=5で多めに取得 → 閾値フィルタ → RETURN_K=3で返却
- テスト結果（14問に拡張）
  - Before: 9/10 (90%), 平均距離 0.22
  - After:  13/14 (93%), 平均距離 0.26
  - Q1「RAGとは？」: MISS → HIT に改善（manual_003がTop1に）
  - Q2「LLMの限界は？」: manual_002(AI基礎)がTop1に（manual_003が期待）→ 唯一のMISS
  - 新規4問（Q11-14）: 全問HIT
