# Day4_v2 ドキュメント

データモデル・画面仕様（Day2準拠）・動作確認手順をまとめています。

---

## 1. 概要・アーキテクチャ

- **構成**: React (Vite) + Firebase Firestore。フロントから Firestore へ直接アクセス。
- **バックエンド**: FastAPI は補助用途（`GET /health` 等）。ToDo の正は Firestore。

```
[ブラウザ]
    │  HTTPS (Firebase SDK)
    ▼
[React フロントエンド]  ←  Vite 開発サーバ (localhost:5200)
    │  Firestore 呼び出し（firestore.js）
    ▼
[Firebase Firestore]  ←  コレクション: lists, tasks
```

---

## 2. データモデル（Firestore）

### lists コレクション

| フィールド | 型        | 説明       |
|------------|-----------|------------|
| name       | string    | リスト名   |
| createdAt  | Timestamp | 作成日時   |

- ドキュメント ID は Firestore の自動採番（他で `listId` として参照）。
- **デフォルトリスト**: 名前は「デフォルトリスト」（Day2 準拠）。0 件または存在しないときに自動作成され、削除不可。

### tasks コレクション

| フィールド   | 型        | 説明                     |
|--------------|-----------|--------------------------|
| title        | string    | タイトル                 |
| isCompleted  | boolean   | 完了フラグ               |
| isFavorite   | boolean   | お気に入り               |
| dueDate      | string \| null | 期限（YYYY-MM-DD） |
| listId       | string    | 所属リストのドキュメント ID |
| memo         | string    | メモ                     |
| createdAt    | Timestamp | 作成日時                 |

- **タイマー**: `elapsedSeconds` は state のみで管理。Firestore には保存しない（Day2 準拠・リロードでリセット）。
- **表示順**: 新規追加は先頭。Firestore では `createdAt` 降順で取得。

---

## 3. 画面仕様（Day2準拠）

### 3.1 レイアウト（Day2 の HTML 構成に対応）

- 見出し「ToDoアプリ」
- カウンター行: 未完了／完了／お気に入り／期限切れ
- リストセクション: セレクト、リスト追加、リスト削除
- タスク入力欄と「追加」ボタン
- タスク一覧（各タスクにチェック／編集／削除／★／期限／メモ／タイマー UI）

### 3.2 主要コンポーネント

| コンポーネント | 責務 |
|----------------|------|
| App | 状態（tasks, lists, currentListId, runningTimerTaskId 等）の保持。Firestore 取得・更新。 |
| CounterRow | 未完了・完了・お気に入り・期限切れの件数表示。 |
| ListSection | リスト選択・リスト追加・削除。デフォルトは削除不可。 |
| TaskForm | タスク入力と追加。 |
| TaskList | 現在リストに属するタスクのみ表示。 |
| TaskItem | 1 タスクの表示・完了・編集・削除・お気に入り・期限・メモ・タイマー UI。 |

### 3.3 タイマー仕様（Day2準拠）

- 同時に動くタイマーは **1 つだけ**。
- `elapsedSeconds` は state のみで管理。
- リロードでリセット。Firestore には保存しない。

---

## 4. 動作確認チェックリスト

### 4.1 確認項目一覧

| # | 確認内容 | 期待する結果 |
|---|----------|--------------|
| 1 | 初回表示 | デフォルトで「デフォルトリスト」が 1 件ある |
| 2 | タスク追加 | 入力→追加で一覧にタスクが増える。**新規タスクは先頭**に出る |
| 3 | タスク完了 | チェックで完了／未完了が切り替わる |
| 4 | タスク編集 | 編集でタイトルを変更できる |
| 5 | お気に入り | ★でお気に入り ON/OFF できる |
| 6 | 期限 | 日付を選ぶと「期限内／期限切れ」が変わる |
| 7 | タイマー | 開始・停止・リセットで経過が変わる。**リロードでリセット**（永続化しない） |
| 8 | メモ | メモ欄の入力が保持される（リロード後も残る） |
| 9 | タスク削除 | 削除で一覧から消える |
| 10 | リスト追加 | 新しいリストがセレクトに増える |
| 11 | リスト切り替え | セレクトで切り替えると、そのリストのタスクだけ表示される |
| 12 | リスト削除 | デフォルト以外のリストを削除できる。削除時は属するタスクをデフォルトへ移動 |
| 13 | デフォルト削除不可 | デフォルトリストは削除ボタンが無効 |
| 14 | リロード | 再読み込み後もタスク・リスト・メモ等が残る |
| 15 | Firestore | Firebase Console で `lists` / `tasks` にデータがある |

### 4.2 動作確認手順（手順書）

#### 準備

1. `Day4_v2/frontend` で `npm install` を実行。
2. `.env.example` を `.env` にコピーし、Firebase 設定（`VITE_FIREBASE_*`）を記入。
3. `npm run dev` で起動し、http://localhost:5200 を開く。

#### 1. 初回表示

- [ ] 見出し「ToDoアプリ」が表示されている。
- [ ] カウンターが「未完了：0件」「完了：0件」「お気に入り：0件」「期限切れ：0件」となっている。
- [ ] リストに「デフォルトリスト」が 1 件ある。
- [ ] タスク一覧は空。

#### 2. タスク操作

- [ ] タスク入力欄に「テストタスク」と入力し「追加」→ 一覧の**先頭**に表示される。
- [ ] チェックボックスをクリック → 完了状態になる（取り消しも可能）。
- [ ] 編集ボタンでタイトルを変更できる。
- [ ] ★ボタンでお気に入り ON/OFF できる。
- [ ] 期限を設定すると「期限内／期限切れ」が表示される。
- [ ] メモ欄に入力し他をクリック（Blur）→ リロード後もメモが残る。
- [ ] タイマーを開始 → 経過が進む。停止・リセットで挙動が変わる。
- [ ] ページをリロード → タイマーは 0 にリセットされる。
- [ ] 削除ボタンでタスクが消える。

#### 3. リスト操作

- [ ] 「リスト追加」で新しいリストを追加 → セレクトに増える。
- [ ] セレクトで切り替えると、表示タスクが変わる。
- [ ] デフォルト以外のリストを選択して「リスト削除」→ 確認後、そのリストが消え、タスクはデフォルトへ移動する。
- [ ] デフォルトリスト選択時は「リスト削除」が無効または非表示。

#### 4. 永続化確認

- [ ] タスク・リスト・メモ等を操作したあと、ページをリロードする。
- [ ] データが保持されている。
- [ ] [Firebase Console](https://console.firebase.google.com/) → Firestore で `lists` / `tasks` にドキュメントがある。

### 4.3 エラー時の確認

| 現象 | 確認内容 |
|------|----------|
| 画面が真っ白 | F12 の Console でエラー確認。`.env` 未設定・誤りが多い。 |
| 「読み込みに失敗しました」 | Firestore のルール・ネットワークを確認。 |
| タスクが増えない | Console のエラー確認。`.env` 変更後は `npm run dev` を再起動。 |
| ポート使用中 | vite.config.js で 5200 が使われているか確認。必要なら 5201 等に変更。 |

---

## 5. Day2 との差分

| 項目 | Day2 | Day4_v2 |
|------|------|---------|
| データ保存 | localStorage | Firestore |
| デフォルトリスト名 | デフォルトリスト | デフォルトリスト |
| タイマー永続化 | しない | しない |
| タスク表示順 | 新規は先頭 | 新規は先頭 |
| カウンター | 4項目 | 4項目 |

---

## 6. まとめ

- 本ドキュメントは Day4_v2 のデータモデル・画面仕様・動作確認手順をまとめたものです。
- 起動・画面構成・動作確認（1～15）・エラー時の対応は上記のとおりです。
- Day4_v2 は Day2 相当の機能を Firestore で永続化した構成です。
